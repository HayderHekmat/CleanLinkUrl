<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CleanLink – Remove Tracking From URLs</title>
  <meta name="description" content="Paste any URL and instantly remove tracking parameters like utm_*, fbclid, gclid, and more. Get a clean, privacy‑friendly link and optional QR code.">
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='0.9em' font-size='90'%3E%F0%9F%93%8C%3C/text%3E%3C/svg%3E">
  <!-- Tailwind via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- QRCode generator (pure JS) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <style>
    /* Smooth focus ring */
    .focus-soft:focus { outline: none; box-shadow: 0 0 0 4px rgba(59,130,246,.25); }
    #qrcode canvas {
      border-radius: 0.75rem;
      max-width: 100%;
      height: auto;
    }
  </style>
  <script>
    class TextScramble {
      constructor(el) {
        this.el = el;
        this.chars = '!<>-_\\/[]{}—=+*^?#________';
        this.update = this.update.bind(this);
      }
      setText(newText) {
        const oldText = this.el.innerText;
        const length = Math.max(oldText.length, newText.length);
        const promise = new Promise((resolve) => (this.resolve = resolve));
        this.queue = [];
        for (let i = 0; i < length; i++) {
          const from = oldText[i] || '';
          const to = newText[i] || '';
          const start = Math.floor(Math.random() * 40);
          const end = start + Math.floor(Math.random() * 40);
          this.queue.push({ from, to, start, end });
        }
        cancelAnimationFrame(this.frameRequest);
        this.frame = 0;
        this.update();
        return promise;
      }
      update() {
        let output = '';
        let complete = 0;
        for (let i = 0, n = this.queue.length; i < n; i++) {
          let { from, to, start, end, char } = this.queue[i];
          if (this.frame >= end) {
            complete++;
            output += to;
          } else if (this.frame >= start) {
            if (!char || Math.random() < 0.28) {
              char = this.randomChar();
              this.queue[i].char = char;
            }
            output += `<span class="text-indigo-600">${char}</span>`;
          } else {
            output += from;
          }
        }
        this.el.innerHTML = output;
        if (complete === this.queue.length) {
          this.resolve();
        } else {
          this.frameRequest = requestAnimationFrame(this.update);
          this.frame++;
        }
      }
      randomChar() {
        return this.chars[Math.floor(Math.random() * this.chars.length)];
      }
    }
  </script>
</head>
<body class="bg-slate-50 text-slate-900">
  <header class="max-w-3xl mx-auto px-4 pt-10 pb-6">
    <div class="flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="w-12 h-12 rounded-2xl bg-gradient-to-br from-slate-900 to-indigo-700 text-white grid place-items-center font-extrabold text-xl shadow-md transition-transform duration-300 hover:scale-110">
            CL
        </div>
        <h1 class="text-2xl font-semibold tracking-tight">CleanLink</h1>
      </div>
      <nav class="hidden sm:flex items-center gap-3 text-sm">
        <a href="#how" class="hover:underline">How it works</a>
        <a href="#privacy" class="hover:underline">Privacy</a>
        <a id="goProTop" class="px-3 py-1.5 rounded-xl bg-indigo-600 text-white hover:bg-indigo-700 cursor-pointer">Go Pro</a>
      </nav>
    </div>
  </header>

  <main class="max-w-3xl mx-auto px-4 pb-24">
    <!-- Hero -->
    <section class="text-center mb-8">
        <h2 id="scrambleText" class="text-3xl sm:text-4xl font-bold tracking-tight bg-gradient-to-r from-slate-900 to-indigo-700 bg-clip-text text-transparent">
          Clean and simplify your URLs — instantly
        </h2>

        <p class="text-slate-600 mt-2">
          Remove tracking codes, UTM tags, or any unwanted parameters in one click.
          Share a clean, privacy‑friendly link that keeps only what matters.
        </p>
      </section>

      <!-- ✅ put this here -->
      <script>
        document.addEventListener('DOMContentLoaded', () => {
          const el = document.getElementById('scrambleText');
          const fx = new TextScramble(el);

          const phrases = [
            'Clean and simplify your URLs — instantly',
            'Remove all tracking and junk',
            'Share privacy-friendly links',
          ];

          let counter = 0;
          const next = () => {
            fx.setText(phrases[counter]).then(() => {
              setTimeout(next, 2500);
            });
            counter = (counter + 1) % phrases.length;
          };
          next();
        });
      </script>

    <section class="bg-white rounded-2xl shadow-sm border border-slate-200 p-4 sm:p-6">
      <label for="urlInput" class="block text-sm font-medium text-slate-700 mb-2">Paste URL</label>
      <div class="flex gap-2">
        <input id="urlInput" type="text" placeholder="https://example.com/?utm_source=ad&fbclid=XYZ" class="flex-1 w-full rounded-xl border border-slate-300 px-3 py-2 focus-soft" />
        <button id="cleanBtn" class="px-4 py-2 rounded-xl bg-slate-900 text-white hover:bg-slate-800">Clean</button>
      </div>

      <details class="mt-3">
        <summary class="text-sm text-slate-600 cursor-pointer">Advanced: preserve specific parameters</summary>
        <p class="text-xs text-slate-500 mt-2">Comma-separated list (e.g., <code>ref,aff_id</code>)</p>
        <input id="preserveInput" type="text" placeholder="ref,aff_id" class="mt-2 w-full rounded-xl border border-slate-300 px-3 py-2 focus-soft" />
      </details>

      <label class="flex items-center mt-3 text-sm text-slate-700 gap-2">
        <input id="removeAll" type="checkbox" class="rounded border-slate-300">
        <span>Remove all query parameters</span>
      </label>

      <div id="resultWrap" class="hidden mt-6">
        <div class="flex items-start gap-3">
          <div class="flex-1">
            <p class="text-sm text-slate-600">Clean URL</p>
            <div id="resultUrl" class="font-mono break-all bg-slate-50 border border-slate-200 rounded-xl p-3 mt-1"></div>
            <div class="flex gap-2 mt-3">
              <button id="copyBtn" class="px-3 py-2 rounded-xl border border-slate-300 hover:bg-slate-100">Copy</button>
              <button id="openBtn" class="px-3 py-2 rounded-xl border border-slate-300 hover:bg-slate-100">Open</button>
              <button id="shareBtn" class="px-3 py-2 rounded-xl border border-slate-300 hover:bg-slate-100">Share</button>
            </div>
          </div>
          <div id="qrWrap" class="hidden flex flex-col items-center w-full sm:w-[200px]">
            <div class="text-sm text-slate-600 mb-1">QR code</div>
            <div id="qrcode" class="p-2 bg-white border border-slate-200 rounded-xl flex justify-center items-center w-[180px] h-[180px]"></div>
            <button id="downloadQRBtn" class="mt-2 w-full px-3 py-2 rounded-xl border border-slate-300 hover:bg-slate-100 text-sm">
              Download PNG
            </button>
          </div>
        </div>
      </div>

      <p id="error" class="hidden mt-4 text-sm text-red-600"></p>
    </section>

    <section id="how" class="mt-10 grid sm:grid-cols-3 gap-4 text-sm">
      <div class="bg-white rounded-2xl border border-slate-200 p-4">
        <div class="font-semibold">1) Paste a link</div>
        <p class="text-slate-600 mt-1">We parse it safely with the URL standard.</p>
      </div>
      <div class="bg-white rounded-2xl border border-slate-200 p-4">
        <div class="font-semibold">2) Strip trackers</div>
        <p class="text-slate-600 mt-1">We remove common parameters (<code>utm_*</code>, <code>fbclid</code>, <code>gclid</code>, <code>igshid</code>, etc.).</p>
      </div>
      <div class="bg-white rounded-2xl border border-slate-200 p-4">
        <div class="font-semibold">3) Copy & share</div>
        <p class="text-slate-600 mt-1">Copy, open, share, or generate a QR code.</p>
      </div>
    </section>

    <section class="mt-12 bg-gradient-to-br from-indigo-600 to-purple-600 text-white rounded-2xl p-6">
      <div class="flex flex-col sm:flex-row sm:items-center gap-3 justify-between">
        <div>
          <div class="text-lg font-semibold">Need analytics or dynamic redirects?</div>
          <p class="opacity-90">Upgrade to CleanLink Pro: click tracking • custom short links • geo/device rules.</p>
        </div>
        <a id="goProCta" class="inline-block px-4 py-2 rounded-xl bg-white/10 hover:bg-white/20 border border-white/20 cursor-pointer">Get Pro</a>
      </div>
    </section>

    <section id="privacy" class="mt-10 text-xs text-slate-600">
      <p><strong>Privacy:</strong> All cleaning happens client-side in your browser. No URLs are stored or sent anywhere by this page. If you choose Pro features later (click analytics, short links), we will ask for consent.</p>
    </section>
  </main>

  <footer class="max-w-3xl mx-auto px-4 pb-10 text-xs text-slate-500">
    <div class="flex items-center justify-between">
      <p>© <span id="year"></span> CleanLink. Built for privacy-first sharing.</p>
      <a class="hover:underline" href="#" id="contactLink">Contact</a>
    </div>
  </footer>

  <script>
    const yearEl = document.getElementById('year');
    yearEl.textContent = new Date().getFullYear();

    const urlInput = document.getElementById('urlInput');
    const preserveInput = document.getElementById('preserveInput');
    const cleanBtn = document.getElementById('cleanBtn');
    const resultWrap = document.getElementById('resultWrap');
    const resultUrl = document.getElementById('resultUrl');
    const errorEl = document.getElementById('error');
    const copyBtn = document.getElementById('copyBtn');
    const openBtn = document.getElementById('openBtn');
    const shareBtn = document.getElementById('shareBtn');
    const qrWrap = document.getElementById('qrWrap');
    const qrcodeEl = document.getElementById('qrcode');
    const goProTop = document.getElementById('goProTop');
    const goProCta = document.getElementById('goProCta');

    const PRO_URL = 'https://buy.stripe.com/test_XXXXXXX';
    goProTop.addEventListener('click', () => window.location.href = PRO_URL);
    goProCta.addEventListener('click', () => window.location.href = PRO_URL);

    const TRACKER_KEYS = [
      'utm_source','utm_medium','utm_campaign','utm_term','utm_content','utm_id','utm_name',
      'gclid','fbclid','msclkid','twclid','yclid','dclid','gbraid','wbraid','mc_cid','mc_eid',
      'igshid','si','ref_src','ref_url','ref','vero_id','vero_conv','_hsenc','_hsmi','mkt_tok',
      'tag','ascsubtag','spm','camp','linkId','ncid',
      'fb_action_ids','fb_action_types','fb_ref','fb_source','amp','amp_gsa','amp_js_v',
    ];

    const BLOCKLIST = new Set(TRACKER_KEYS.map((key) => key.toLowerCase()));

    function normalizeUrl(raw) {
      try {
        return new URL(raw);
      } catch (e) {
        try { return new URL('https://' + raw); } catch (e2) { throw e; }
      }
    }

    function cleanURL(raw, preserveList = []) {
      const preserve = new Set(preserveList.map(s => s.trim().toLowerCase()).filter(Boolean));
      const removeAll = document.getElementById('removeAll').checked;
      const url = normalizeUrl(raw);
      const params = url.searchParams;
      const keysToDelete = [];

      params.forEach((_, key) => {
        const lower = key.toLowerCase();
        let shouldDelete = false;

        if (removeAll) {
          shouldDelete = true;
        } else {
          shouldDelete = BLOCKLIST.has(lower) || lower.startsWith('utm_');
        }

        if (shouldDelete && !preserve.has(lower)) {
          keysToDelete.push(key);
        }
      });

      keysToDelete.forEach(k => params.delete(k));

      if ([...params.keys()].length === 0) url.search = '';
      if (url.hash && /utm_|fbclid|gclid|msclkid|twclid/i.test(url.hash)) {
        url.hash = '';
      }
      if (url.pathname === '/') url.pathname = '';

      return url.toString();
    }

    function showError(msg) {
      errorEl.textContent = msg;
      errorEl.classList.remove('hidden');
      resultWrap.classList.add('hidden');
      qrWrap.classList.add('hidden');
      qrcodeEl.innerHTML = '';
    }

    function hideError() { errorEl.classList.add('hidden'); }

    function renderQR(text) {
      const size = 160;
      qrcodeEl.innerHTML = '';

      const qr = new QRCode(qrcodeEl, {
        text,
        width: size,
        height: size,
        correctLevel: QRCode.CorrectLevel.M,
      });

      setTimeout(() => {
        const img = qrcodeEl.querySelector('img');
        if (!img) return;

        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = size;
        canvas.height = size;

        const tmp = new Image();
        tmp.crossOrigin = 'Anonymous';
        tmp.onload = () => {
          ctx.drawImage(tmp, 0, 0, size, size);
          qrcodeEl.innerHTML = '';
          qrcodeEl.appendChild(canvas);
        };
        tmp.src = img.src;
      }, 120);
    }

    cleanBtn.addEventListener('click', () => {
      hideError();
      const raw = urlInput.value.trim();
      if (!raw) return showError('Please paste a URL first.');

      let preserve = [];
      if (preserveInput.value.trim()) {
        preserve = preserveInput.value.split(',').map(s => s.trim().toLowerCase());
      }

      try {
        const cleaned = cleanURL(raw, preserve);
        resultUrl.textContent = cleaned;
        resultWrap.classList.remove('hidden');
        qrWrap.classList.remove('hidden');

        setTimeout(() => renderQR(cleaned), 150);
      } catch (e) {
        showError(
          'That does not look like a valid URL. Try including the domain like example.com.'
        );
      }
    });

    copyBtn.addEventListener('click', async () => {
      const text = resultUrl.textContent;
      try {
        await navigator.clipboard.writeText(text);
        copyBtn.textContent = 'Copied!';
        setTimeout(() => (copyBtn.textContent = 'Copy'), 1200);
      } catch {}
    });

    openBtn.addEventListener('click', () => {
      const href = resultUrl.textContent;
      if (!href) return;
      window.open(href, '_blank');
    });

    shareBtn.addEventListener('click', async () => {
      const text = resultUrl.textContent;
      if (!text) return;
      if (navigator.share) {
        try {
          await navigator.share({ title: 'Clean link', url: text });
        } catch {}
      } else {
        try {
          await navigator.clipboard.writeText(text);
          shareBtn.textContent = 'Copied!';
          setTimeout(() => (shareBtn.textContent = 'Share'), 1200);
        } catch {}
      }
    });

    const downloadQRBtn = document.getElementById('downloadQRBtn');

    downloadQRBtn.addEventListener('click', () => {
      const canvas = qrcodeEl.querySelector('canvas');
      if (!canvas) return alert('QR not generated yet.');

      const link = document.createElement('a');
      link.download = 'cleanlink-qr.png';
      link.href = canvas.toDataURL('image/png');
      link.click();
    });

    document.getElementById('contactLink').addEventListener('click', (e) => {
      e.preventDefault();
      const body = encodeURIComponent('Hello CleanLink, I have a question about...');
      window.location.href = `mailto:hello@yourdomain.com?subject=CleanLink%20Support&body=${body}`;
    });
  </script>
</body>
</html>
