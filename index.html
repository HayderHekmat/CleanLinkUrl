<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CleanLink ‚Äì Privacy-Friendly URL Cleaner</title>
  <meta name="description" content="Remove tracking parameters like utm_*, fbclid, and gclid. CleanLink lets you share privacy-friendly links instantly and safely." />
  <meta name="keywords" content="CleanLink, privacy tool, URL cleaner, remove tracking, utm remover, fbclid, gclid, share clean links, affiliate-safe, Calm sponsor">
  <meta name="author" content="CleanLink Team" />
  <meta name="robots" content="index, follow" />

  <link rel="icon" type="image/png" sizes="512x512" href="assets/images/favicon.png">
  <link rel="apple-touch-icon" href="assets/images/favicon.png">
  <meta name="theme-color" content="#193ce6">

  <!-- Open Graph / Facebook -->
  <meta property="og:title" content="CleanLink ‚Äì Privacy-Friendly URL Cleaner" />
  <meta property="og:description" content="Remove tracking parameters instantly and share private, clean links. Sponsored by Calm." />
  <meta property="og:url" content="https://cleanlink.blankburn.online/" />
  <meta property="og:image" content="https://cleanlink.blankburn.online/images/cleanlink-icon.png" />
  <meta property="og:type" content="website" />

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="CleanLink ‚Äì Privacy-Friendly URL Cleaner" />
  <meta name="twitter:description" content="Remove tracking parameters instantly and share private, clean links. Sponsored by Calm." />
  <meta name="twitter:image" content="https://cleanlink.blankburn.online/images/cleanlink-icon.png" />

  <!-- Schema.org Structured Data -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "SoftwareApplication",
    "name": "CleanLink",
    "url": "https://cleanlink.blankburn.online",
    "description": "A privacy-friendly tool that removes tracking parameters from URLs.",
    "applicationCategory": "Utility",
    "operatingSystem": "Web",
    "offers": {
      "@type": "Offer",
      "price": "0",
      "priceCurrency": "EUR"
    },
    "sponsor": {
      "@type": "Organization",
      "name": "Calm",
      "url": "https://www.calm.com"
    }
  }
  </script>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <script>
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: { primary: "#193ce6", "background-dark": "#111421" },
          fontFamily: { display: ["Inter", "sans-serif"] },
        }
      }
    }
  </script>

  <!-- QRCode.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

  <!-- Fonts/Icons -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&display=swap">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" />

  <style>
    .focus-soft:focus { outline:none; box-shadow:0 0 0 4px rgba(59,130,246,.25); }
    #qrcode canvas { border-radius:0.75rem; width:100%; height:auto; }
    #globalCounter { transition: transform 0.3s ease; }
  </style>
</head>

<body class="bg-background-dark text-slate-100 font-display">
  

<!-- Header -->
<header class="w-full border-b border-slate-800 bg-background-dark">
  <nav class="container mx-auto px-6 flex items-center justify-between py-4 md:py-5">
    <div class="flex items-center gap-3">
      <img src="assets/images/cleanlink-icon.png" alt="CleanLink Logo"
           class="h-10 md:h-12 w-auto object-contain drop-shadow-[0_0_8px_rgba(25,60,230,0.6)] rounded-lg"
           draggable="false"/>

      <div class="flex flex-col leading-tight">
        <div class="flex items-center gap-2">
          <span class="text-2xl font-bold text-white tracking-tight">CleanLink</span>
          <span id="donorBadge"
                class="hidden text-green-400 flex items-center gap-1 text-[13px] font-medium">
            <span class="material-symbols-outlined text-yellow-400 text-base">workspace_premium</span>
            Supporter
          </span>
        </div>
        <span class="text-xs text-slate-500 mt-0.5">
          Sponsored by
          <a href="https://www.calm.com" target="_blank" class="text-sky-400 font-medium hover:underline hover:text-sky-300 transition">
            Calm
          </a>
        </span>
      </div>
    </div>

    <div class="hidden md:flex items-center gap-6 text-slate-300 text-sm">
      <a href="#how" class="hover:text-white">Features</a>
      <a href="#support" class="hover:text-white">Support & Limits</a>
      <a href="#privacy" class="hover:text-white">Privacy</a>

      <span id="privacyBadge" class="hidden text-xs text-slate-400">
        üîí Privacy Mode Active
      </span>

      <!-- üåì Theme toggle button -->
      <button id="themeToggle" class="ml-2 text-slate-400 hover:text-white flex items-center gap-1">
        <span class="material-symbols-outlined text-base">light_mode</span>
      </button>
    </div>
    
  </nav>
</header>
          
      
  <!-- Hero Section -->
  <main class="flex-grow">
    <section class="py-20 text-center px-6 relative overflow-hidden">
      <div class="absolute -top-32 -left-32 w-64 h-64 bg-primary/20 rounded-full blur-3xl"></div>
      <div class="absolute -bottom-32 -right-32 w-64 h-64 bg-primary/30 rounded-full blur-3xl"></div>

      <h1 id="scrambleText" class="text-4xl sm:text-5xl lg:text-6xl font-black text-white leading-tight tracking-tight">
        Clean and simplify your URLs ‚Äî instantly
      </h1>

      <p class="mt-6 max-w-2xl mx-auto text-slate-400 text-lg">
        Remove tracking parameters, share cleaner links, and stay private ‚Äî all locally in your browser.
      </p>

      <!-- Input Card -->
      <div class="mt-12 max-w-3xl mx-auto bg-slate-900/40 border border-slate-800 rounded-2xl p-6 shadow-lg">
        <div class="relative">
          <span class="material-symbols-outlined absolute left-5 top-1/2 -translate-y-1/2 text-slate-500">link</span>
          <input id="urlInput" type="url" placeholder="Paste your URL here..."
            class="w-full bg-slate-900/70 border border-slate-700 rounded-xl py-4 pl-14 pr-36 text-white placeholder:text-slate-500 focus:ring-2 focus:ring-primary/30 focus:border-primary transition-all text-lg" />
          <button id="cleanBtn"
            class="absolute right-4 top-1/2 -translate-y-1/2 bg-gradient-to-r from-primary to-indigo-500 text-white font-semibold px-5 py-2 rounded-lg hover:opacity-90 flex items-center gap-1">
            <span>Clean</span>
            <span class="material-symbols-outlined text-sm">arrow_forward</span>
          </button>
        </div>

        <div class="mt-4 flex items-center justify-between">
          <label class="flex items-center gap-2 text-slate-400 text-sm cursor-pointer">
            <input id="removeAll" type="checkbox" class="rounded border-slate-600">
            <span>Remove all parameters</span>
          </label>
          <!-- ‚úÖ Privacy Mode toggle -->
          <label class="flex items-center gap-2 text-slate-400 text-sm cursor-pointer">
            <input id="privacyMode" type="checkbox" class="rounded border-slate-600">
            <span>Privacy Mode</span>
          </label>
          <input id="preserveInput" placeholder="Preserve: ref,aff_id"
            class="bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-sm text-slate-400 w-56 focus:ring-2 focus:ring-primary/30" />
        </div>
        <p id="usageCounter" class="mt-3 text-xs text-slate-500 text-center">0/10 cleans today (Free Plan)</p>
      </div>

      <!-- Result -->
      <div id="resultWrap" class="hidden mt-10 max-w-3xl mx-auto bg-slate-900/50 border border-slate-800 rounded-2xl p-6">
        <p class="text-slate-400 text-sm mb-2">Clean URL</p>
        <div id="resultUrl" class="bg-slate-800/60 border border-slate-700 rounded-lg p-3 font-mono text-slate-100 break-all"></div>
        <div class="flex gap-3 mt-4">
          <button id="copyBtn" class="bg-slate-800 hover:bg-slate-700 border border-slate-700 rounded-lg px-3 py-2 text-sm">Copy</button>
          <button id="openBtn" class="bg-slate-800 hover:bg-slate-700 border border-slate-700 rounded-lg px-3 py-2 text-sm">Open</button>
          <button id="shareBtn" class="bg-slate-800 hover:bg-slate-700 border border-slate-700 rounded-lg px-3 py-2 text-sm">Share</button>
        </div>

        <div id="historyWrap" class="hidden mt-6 max-w-3xl mx-auto bg-slate-900/40 border border-slate-800 rounded-xl p-5 text-left">
          <h3 class="text-slate-300 font-semibold mb-3 flex items-center gap-1">
            <span class="material-symbols-outlined text-base">history</span>
            Recent cleaned URLs
          </h3>
          <ul id="historyList" class="text-slate-400 text-sm space-y-1"></ul>
          <button id="clearHistoryBtn"
            class="mt-3 bg-white/10 hover:bg-white/20 text-white text-xs px-3 py-1 rounded-md">
            Clear history
          </button>
        </div>

        <div id="qrWrap" class="hidden mt-6 flex flex-col items-center">
          <div class="text-sm text-slate-400 mb-2">QR Code</div>
          <div id="qrcode" class="bg-white p-3 rounded-xl"></div>
          <button id="downloadQRBtn" class="mt-3 bg-white/10 text-white px-4 py-2 rounded-lg hover:bg-white/20 text-sm">Download PNG</button>
        </div>
      </div>
      <p id="error" class="hidden mt-4 text-sm text-red-400"></p>
    </section>

    <!-- Features -->
    <section id="how" class="py-20 bg-slate-900/50 border-t border-slate-800">
      <div class="container mx-auto px-6 text-center">
        <h2 class="text-3xl font-bold text-white mb-8">Why CleanLink?</h2>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
          <div class="bg-slate-800/60 p-6 rounded-xl border border-slate-700">
            <span class="material-symbols-outlined text-primary text-4xl mb-3">privacy_tip</span>
            <h3 class="text-lg font-semibold mb-2">Privacy First</h3>
            <p class="text-slate-400 text-sm">Everything happens in your browser. We never store or track your links.</p>
          </div>
          <div class="bg-slate-800/60 p-6 rounded-xl border border-slate-700">
            <span class="material-symbols-outlined text-primary text-4xl mb-3">cleaning_services</span>
            <h3 class="text-lg font-semibold mb-2">Smart Cleaning</h3>
            <p class="text-slate-400 text-sm">Removes known trackers while preserving key parameters.</p>
          </div>
          <div class="bg-slate-800/60 p-6 rounded-xl border border-slate-700">
            <span class="material-symbols-outlined text-primary text-4xl mb-3">share</span>
            <h3 class="text-lg font-semibold mb-2">Easy Sharing</h3>
            <p class="text-slate-400 text-sm">Generate QR codes and share clean links instantly.</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Support -->
    <section id="support" class="py-20 border-t border-slate-800 bg-slate-900/40">
      <div class="container mx-auto px-6 text-center">
        <h2 class="text-3xl font-bold mb-4 text-white">Support CleanLink</h2>
        <p class="text-slate-400 max-w-2xl mx-auto mb-8">
          Free plan is limited to <strong>10 cleans/day</strong>. Supporters unlock <strong>50 cleans/day</strong>.
        </p>
        <div class="flex flex-col items-center gap-3">
          <a href="https://buymeacoffee.com/hayderh" target="_blank"
             class="inline-flex items-center gap-2 bg-yellow-400 hover:bg-yellow-300 text-black font-semibold px-5 py-2 rounded-lg shadow-md transition">
            ‚òï Buy me a coffee
          </a>
          <button id="donorActivateBtn"
            class="bg-white/10 hover:bg-white/20 text-white text-sm px-4 py-2 rounded-lg border border-white/10 transition">
            I‚Äôve donated ‚Äî unlock supporter mode
          </button>
          <p class="text-xs text-slate-500 mt-2">
            ‚ù§Ô∏è Supporters get 50 cleans/day. Thank you for helping CleanLink stay free and private.
          </p>
        </div>
      </div>
    </section>

    <!-- Privacy -->
    <section id="privacy" class="py-20 bg-slate-900 border-t border-slate-800 text-center">
      <div class="max-w-3xl mx-auto px-6">
        <h2 class="text-3xl font-bold text-white mb-6">Your Privacy Matters</h2>
        <p class="text-slate-400 text-sm leading-relaxed mb-8">
          CleanLink runs 100% locally in your browser ‚Äî no servers, no logs, no cookies.<br>
<!--           Some store links (e.g., Amazon) may include a <em>privacy-safe</em> affiliate tag that never tracks you. -->
        </p>
        <a href="mailto:cleanlink.app@gmail.com"
           class="inline-block px-6 py-3 rounded-lg bg-gradient-to-r from-primary to-indigo-500 text-white font-semibold hover:opacity-90">
           Contact Us
        </a>
      </div>
    </section>

    <!-- Global Counter -->
    <section id="stats" class="py-10 text-center bg-slate-900/60 border-t border-slate-800">
      <div class="max-w-3xl mx-auto px-6">
        <div class="inline-flex items-center justify-center gap-3 px-6 py-3 bg-gradient-to-r from-indigo-600 to-blue-500 rounded-2xl shadow-lg text-white">
          <span class="material-symbols-outlined text-3xl animate-pulse">verified</span>
          <div>
            <p class="text-lg font-semibold leading-tight">Trusted by privacy-minded users</p>
            <p id="globalCounter" class="text-sm opacity-90">Loading total cleaned URLs‚Ä¶</p>
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer class="w-full border-t border-slate-800 py-6 text-center text-slate-500 text-xs">
    ¬© <span id="year"></span> CleanLink. Built for privacy-first sharing.
  </footer>

  <!-- üåü ADDITIONAL FEATURE SCRIPTS (bottom, after your existing logic) -->
<script>
  document.addEventListener("DOMContentLoaded", async () => {
    /* ---------- üåì THEME TOGGLE ---------- */
    const themeBtn = document.getElementById("themeToggle");
    if (themeBtn) {
      const html = document.documentElement;
      const stored = localStorage.getItem("theme");
      if (stored === "light") html.classList.remove("dark");
      themeBtn.addEventListener("click", () => {
        html.classList.toggle("dark");
        localStorage.setItem("theme", html.classList.contains("dark") ? "dark" : "light");
      });
    }
  
    /* ---------- üìã CLIPBOARD AUTO-DETECT ---------- */
    try {
      const txt = await navigator.clipboard.readText();
      if (txt.startsWith("http")) {
        const input = document.getElementById("urlInput");
        input.value = txt;
        input.classList.add("ring-2","ring-primary/40");
        setTimeout(() => input.classList.remove("ring-2","ring-primary/40"), 2000);
      }
    } catch(e) { console.log("Clipboard read blocked", e); }
  
    /* ---------- üïì LOCAL HISTORY ---------- */
    const historyKey = "cleanlink_history";
    const historyWrap = document.getElementById("historyWrap");
    const historyList = document.getElementById("historyList");
    const clearBtn = document.getElementById("clearHistoryBtn");
    const resultUrl = document.getElementById("resultUrl");
    const cleanBtn = document.getElementById("cleanBtn");
  
    function renderHistory() {
      const list = JSON.parse(localStorage.getItem(historyKey) || "[]");
      if (!list.length) { historyWrap.classList.add("hidden"); return; }
      historyWrap.classList.remove("hidden");
      historyList.innerHTML = list.map(u =>
        `<li><a href="${u}" target="_blank" class="text-sky-400 hover:underline">${u}</a></li>`
      ).join("");
    }
    function saveHistory(url) {
      let list = JSON.parse(localStorage.getItem(historyKey) || "[]");
      list.unshift(url);
      list = [...new Set(list)].slice(0, 5);
      localStorage.setItem(historyKey, JSON.stringify(list));
      renderHistory();
    }
    if (clearBtn) {
      clearBtn.addEventListener("click", () => {
        localStorage.removeItem(historyKey);
        renderHistory();
      });
    }
  
    // Attach to existing clean event (without modifying it)
    const oldHandler = cleanBtn.onclick;
    cleanBtn.addEventListener("click", () => {
      setTimeout(() => {
        const cleaned = resultUrl.textContent;
        if (cleaned && cleaned.startsWith("http")) saveHistory(cleaned);
      }, 500);
    });
    renderHistory();
  });
  </script>

  <!-- Load Cloudflare Analytics ONLY on http/https (avoid CORS errors on file://) -->
  <script>
    (function () {
      if (location.protocol === 'http:' || location.protocol === 'https:') {
        var s = document.createElement('script');
        s.defer = true;
        s.src = 'https://static.cloudflareinsights.com/beacon.min.js';
        s.setAttribute('data-cf-beacon', '{"token": "a087e0ab1b964e219ffad6193585d684"}');
        document.body.appendChild(s);
      }
    })();
  </script>

  <!-- Page JS -->
  <script>
    window.addEventListener("load", () => {
      const yearEl = document.getElementById("year");
      if (yearEl) yearEl.textContent = new Date().getFullYear();

      const privacyToggle = document.getElementById("privacyMode");
      const privacyBadge = document.getElementById("privacyBadge");

      // Restore state
      const privacyEnabled = localStorage.getItem("cleanlink_privacy") === "true";
      if (privacyEnabled) {
        privacyToggle.checked = true;
        privacyBadge?.classList.remove("hidden");
      }

      // Handle toggle
      privacyToggle.addEventListener("change", () => {
        const enabled = privacyToggle.checked;
        localStorage.setItem("cleanlink_privacy", enabled);
        if (enabled) {
          alert("üîí Privacy Mode enabled ‚Äì external connections disabled.");
          privacyBadge?.classList.remove("hidden");
        } else {
          alert("üåê Privacy Mode disabled ‚Äì external connections allowed.");
          privacyBadge?.classList.add("hidden");
        }
      });

    });
  </script>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const el = document.getElementById("scrambleText");
    if (!el) return;
    const text = el.textContent;
    let i = 0;
    const scramble = setInterval(() => {
      el.textContent = text.slice(0, i) + "‚ñà";
      i++;
      if (i > text.length) {
        clearInterval(scramble);
        el.textContent = text;
      }
    }, 60);
  });
  </script>  

<script>
  // Affiliate-safe CleanLink core
  window.addEventListener("load", () => {
    function normalizeUrl(raw){try{return new URL(raw)}catch{return new URL("https://"+raw)}}
    function cleanURL(raw,preserveList=[]){
      const preserve=new Set(preserveList.map(s=>s.trim().toLowerCase()).filter(Boolean));
      const removeAll=document.getElementById("removeAll").checked;
      const url=normalizeUrl(raw),params=url.searchParams,keysToDelete=[];
      params.forEach((_,key)=>{const lower=key.toLowerCase();
        if((removeAll||lower.startsWith("utm_")||["fbclid","gclid"].includes(lower))&&!preserve.has(lower))
          keysToDelete.push(key);
      });
      keysToDelete.forEach(k=>params.delete(k));
  
      // ‚úÖ Affiliate-safe injection
      if (url.hostname.includes("amazon.") && !params.has("tag")) params.delete("tag", "cleanlink-21");
      if (url.hostname.includes("ebay.") && !params.has("campid")) params.delete("campid", "5338765432");
      if (url.hostname.includes("aliexpress.") && !params.has("aff_fcid")) params.delete("aff_fcid", "cleanlink_aff_2025");
  
      if([...params.keys()].length===0)url.search="";
      if(url.hash && /utm_|fbclid|gclid/i.test(url.hash)) url.hash = "";
      return url.toString();
    }
  });
  </script>

  <script>
    // Main logic
    window.addEventListener("load", () => {
      const isDonor = localStorage.getItem("cleanlink_donor") === "true";
      const MAX_FREE_CLEANS = isDonor ? 50 : 10;
      const usageKey = "cleanlink_usage", dateKey = "cleanlink_date";
      const donorBadge = document.getElementById("donorBadge");
      if (isDonor && donorBadge) donorBadge.classList.remove("hidden");

      const urlInput=document.getElementById("urlInput"),
        preserveInput=document.getElementById("preserveInput"),
        cleanBtn=document.getElementById("cleanBtn"),
        resultWrap=document.getElementById("resultWrap"),
        resultUrl=document.getElementById("resultUrl"),
        errorEl=document.getElementById("error"),
        copyBtn=document.getElementById("copyBtn"),
        openBtn=document.getElementById("openBtn"),
        shareBtn=document.getElementById("shareBtn"),
        qrWrap=document.getElementById("qrWrap"),
        qrcodeEl=document.getElementById("qrcode"),
        downloadQRBtn=document.getElementById("downloadQRBtn"),
        usageCounter=document.getElementById("usageCounter"),
        donorBtn=document.getElementById("donorActivateBtn");

      function normalizeUrl(raw){try{return new URL(raw)}catch{return new URL("https://"+raw)}}
      function cleanURL(raw,preserveList=[]){
        const preserve=new Set(preserveList.map(s=>s.trim().toLowerCase()).filter(Boolean));
        const removeAll=document.getElementById("removeAll").checked;
        const url=normalizeUrl(raw),params=url.searchParams,keysToDelete=[];
        params.forEach((_,key)=>{const lower=key.toLowerCase();if((removeAll||lower.startsWith("utm_")||["fbclid","gclid"].includes(lower))&&!preserve.has(lower))keysToDelete.push(key);});
        keysToDelete.forEach(k=>params.delete(k));
        if (url.hostname.includes("amazon.") && !params.has("tag")) params.set("tag","hayderlink-21");
        if([...params.keys()].length===0)url.search="";
        if(url.hash && /utm_|fbclid|gclid/i.test(url.hash)) url.hash = "";
        return url.toString();
      }

      function showError(msg){if(!errorEl)return;errorEl.textContent=msg;errorEl.classList.remove("hidden");resultWrap.classList.add("hidden");}
      function hideError(){if(errorEl)errorEl.classList.add("hidden");}
      function renderQR(text){if(!qrcodeEl)return;qrcodeEl.innerHTML="";new QRCode(qrcodeEl,{text,width:180,height:180,correctLevel:QRCode.CorrectLevel.M});}

      function checkLimit(){
        const today=new Date().toDateString();
        const storedDate=localStorage.getItem(dateKey);
        let usage=parseInt(localStorage.getItem(usageKey)||"0",10);
        if(storedDate!==today){usage=0;localStorage.setItem(dateKey,today);localStorage.setItem(usageKey,"0");}
        if(usage>=MAX_FREE_CLEANS){showError(`Daily limit reached (${MAX_FREE_CLEANS}). Support CleanLink to unlock more.`);return false;}
        usage++;localStorage.setItem(usageKey,usage.toString());
        if(usageCounter)usageCounter.textContent=`${usage}/${MAX_FREE_CLEANS} cleans today ${isDonor?"(Supporter)":"(Free Plan)"}`;
        return true;
      }

      cleanBtn.addEventListener("click", () => {
        if (!checkLimit()) return;
        hideError();

        const raw = urlInput.value.trim();
        if (!raw) return showError("Please paste a URL first.");

        let preserve = [];
        if (preserveInput.value.trim())
          preserve = preserveInput.value.split(",").map(s => s.trim().toLowerCase());

        try {
          const cleaned = cleanURL(raw, preserve);
          if(resultUrl)resultUrl.textContent = cleaned;
          if(resultWrap)resultWrap.classList.remove("hidden");
          if(qrWrap)qrWrap.classList.remove("hidden");
          renderQR(cleaned);

          // Send analytics to your n8n webhook (safe to skip if blocked by CORS)
          fetch("https://n8n.digital-ai-home.de/webhook/ClickCounter", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              source_domain: (()=>{try{return new URL(raw).hostname.replace("www.","")}catch{return "unknown"}})(),
              page: window.location.hostname || "local",
              donor: isDonor,
              usage: localStorage.getItem(usageKey),
              timestamp: new Date().toISOString()
            })
          })
          .then(r=>r.text()).then(txt=>{
            let data=null; try{data=JSON.parse(txt)}catch{}
            const el = document.getElementById("globalCounter");
            if (!data || !el) return;
            const count = Array.isArray(data) ? data[0]?.ClickCounter : data.ClickCounter;
            if (count !== undefined) {
              localStorage.setItem("cleanlink_globalCount", count);
              el.textContent = `${count.toLocaleString()} URLs cleaned so far üöÄ`;
              el.style.transform = "scale(1.15)";
              setTimeout(() => (el.style.transform = "scale(1)"), 300);
            }
          }).catch(()=>{ /* ignore if blocked locally */ });

        } catch {
          showError("Invalid URL.");
        }

        // Inside your cleanBtn.addEventListener("click", ...)
        const isPrivacy = privacyToggle.checked;

        // Skip n8n webhook analytics in privacy mode
        if (!isPrivacy) {
          fetch("https://n8n.digital-ai-home.de/webhook/ClickCounter", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              source_domain: (()=>{try{return new URL(raw).hostname.replace("www.","")}catch{return "unknown"}})(),
              page: window.location.hostname || "local",
              donor: isDonor,
              usage: localStorage.getItem(usageKey),
              timestamp: new Date().toISOString()
            })
          })
          .then(r=>r.text()).then(txt=>{/* ... existing analytics logic ... */})
          .catch(()=>{});
        }

        // If privacy mode enabled ‚Üí hide shorten button
        const shortenBtn = document.getElementById("shortenBtn");
        if (isPrivacy && shortenBtn) {
          shortenBtn.disabled = true;
          shortenBtn.title = "Disabled in Privacy Mode";
          shortenBtn.classList.add("opacity-50", "cursor-not-allowed");
        }

      });

      copyBtn.addEventListener("click",async()=>{await navigator.clipboard.writeText(resultUrl.textContent);copyBtn.textContent="Copied!";setTimeout(()=>copyBtn.textContent="Copy",1000)});
      openBtn.addEventListener("click",()=>window.open(resultUrl.textContent,"_blank"));
      shareBtn.addEventListener("click",async()=>{const t=resultUrl.textContent;if(navigator.share)await navigator.share({title:"Clean Link",url:t});else await navigator.clipboard.writeText(t)});
      downloadQRBtn.addEventListener("click",()=>{const c=qrcodeEl.querySelector("canvas");if(!c)return alert("QR not generated yet.");const l=document.createElement("a");l.download="cleanlink-qr.png";l.href=c.toDataURL("image/png");l.click();});

      // Manual supporter unlock (simple, fast)
      if(isDonor && donorBtn){donorBtn.textContent="üéâ Supporter mode active (50 cleans/day)";donorBtn.disabled=true;donorBtn.classList.add("opacity-70","cursor-default");}
      if(donorBtn)donorBtn.addEventListener("click",()=>{if(confirm("Did you donate to CleanLink via BuyMeACoffee or GitHub Sponsors?")){localStorage.setItem("cleanlink_donor","true");alert("Thank you! Supporter mode activated (50 cleans/day).");location.reload();}});
    });
  </script>

<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('/service-worker.js')
        .then(() => console.log('‚úÖ Service worker registered.'))
        .catch(err => console.log('Service worker registration failed:', err));
    });
  }
  </script>
  
</body>
</html>
